# Excel 監視コックピット（Component B）

本シートは、Pythonスクリーナーが出力した銘柄コードリストを元に、
楽天証券「マーケットスピード II RSS」関数でリアルタイム監視を行うテンプレートです。

注意: RSSアドインがインストールされ、Excelで有効化されている必要があります。

## レイアウト（推奨）

列見出し（1行目）:

- A: 銘柄コード（入力）
- B: 銘柄名
- C: 現在値
- D: 始値
- E: 高値
- F: 安値
- G: 出来高
- H: AVWAP（09:00アンカー）
- I: ATR(5)（1分足）
- J: 乖離率(ATR単位) = ABS((現在値 - AVWAP) / ATR)
- K: 利確目標（= AVWAP）
- L: 損切目安（= 直近足の極値 ± 1.3×ATR）

## RSS関数例

RSSの関数記法は環境により異なることがあります。代表例:

```
=RSS|'7203';'現在値'
=RSS|'7203';'始値'
=RSS|'7203';'高値'
=RSS|'7203';'安値'
=RSS|'7203';'出来高'
```

銘柄コードを A2 セルに入力した場合、C2 の現在値は次のように参照します:

```
=IF($A2="","",RSS|$A2;"現在値")
```

（お使いの環境に合わせて区切り子や関数形式を調整してください）

## AVWAP と ATR の算出

- AVWAP（09:00アンカー）: RSSで1分足履歴が取得できる場合、別シートに時系列表を設け、
  09:00以降の行に対して `=SUMPRODUCT(終値範囲, 出来高範囲) / SUM(出来高範囲)` を適用してください。
  履歴が難しい場合は簡易版として `=SUMPRODUCT(典型価格, 出来高) / SUM(出来高)`、典型価格 `=(高値+安値+終値)/3` を用いる方法があります。

- ATR(5): 1分足の TrueRange を `MAX(高-安, ABS(高-前終), ABS(安-前終))` として、
  5期間の移動平均を計算します。履歴が取れない場合はExcel上の保有データ範囲で近似します。

## 乖離率と条件付き書式

- J列（乖離率(ATR単位)）に `=IF(I2>0, ABS((C2 - H2)/I2), 0)` を設定
- 条件付き書式: `ABS((C2-H2)/I2) >= 0.6` で背景色を赤（ショートのセットアップ）や緑（ロングのセットアップ）に設定

## 損切目安

- ショート: 直近足の高値 + 1.3×ATR
- ロング: 直近足の安値 - 1.3×ATR

## 運用手順（例）

1. (8:55) Pythonスクリーナーを起動
2. (9:00) 出力された `watchlist.txt` の銘柄コードを A2:A に貼り付け
3. (9:02) 指標計算と条件付き書式の色変化を確認
4. エントリーはトレーダーが最終判断で手動発注

## 既知の注意点

- RSS関数の提供範囲は環境や契約に依存します。分足履歴の提供状況に応じて計算方法を調整してください。
- UDFの書式（区切り子、引数の引用符）は環境によって異なります。実環境のヘルプをご参照ください。

